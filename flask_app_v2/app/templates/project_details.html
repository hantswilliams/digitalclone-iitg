{% extends "layout.html" %}

{% block title %}{{ project.name }} - Digital Clone IITG{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1>{{ project.name }}</h1>
        <p class="text-muted">Created {{ project.created_at.strftime('%B %d, %Y') }}</p>
    </div>
    <div>
        <a href="{{ url_for('project_edit', project_id=project.id) }}" class="btn btn-outline-primary me-2">
            <i class="bi bi-pencil me-1"></i> Edit
        </a>
        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteProjectModal">
            <i class="bi bi-trash me-1"></i> Delete
        </button>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Description</h5>
        <p class="card-text">{{ project.description or 'No description provided' }}</p>
    </div>
</div>

<ul class="nav nav-tabs mb-4" id="projectTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="texts-tab" data-bs-toggle="tab" data-bs-target="#texts" type="button" role="tab" aria-controls="texts" aria-selected="true">
            <i class="bi bi-file-text me-1"></i> Texts
            <span class="badge bg-secondary rounded-pill">{{ project.texts|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="photos-tab" data-bs-toggle="tab" data-bs-target="#photos" type="button" role="tab" aria-controls="photos" aria-selected="false">
            <i class="bi bi-image me-1"></i> Photos
            <span class="badge bg-secondary rounded-pill">{{ project.photos|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="audios-tab" data-bs-toggle="tab" data-bs-target="#audios" type="button" role="tab" aria-controls="audios" aria-selected="false">
            <i class="bi bi-file-earmark-music me-1"></i> Audio
            <span class="badge bg-secondary rounded-pill">{{ project.audios|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="videos-tab" data-bs-toggle="tab" data-bs-target="#videos" type="button" role="tab" aria-controls="videos" aria-selected="false">
            <i class="bi bi-camera-video me-1"></i> Videos
            <span class="badge bg-secondary rounded-pill">{{ project.videos|length }}</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="powerpoints-tab" data-bs-toggle="tab" data-bs-target="#powerpoints" type="button" role="tab" aria-controls="powerpoints" aria-selected="false">
            <i class="bi bi-file-earmark-slides me-1"></i> Presentations
            <span class="badge bg-secondary rounded-pill">{{ project.powerpoints|length }}</span>
        </button>
    </li>
</ul>

<div class="tab-content" id="projectTabsContent">
    <!-- Texts Tab -->
    <div class="tab-pane fade show active" id="texts" role="tabpanel" aria-labelledby="texts-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5">Text Content</h3>
            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addTextModal">
                <i class="bi bi-plus-lg me-1"></i> Add Text
            </button>
        </div>
        
        {% if project.texts %}
            <div class="list-group">
                {% for text in project.texts %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Text #{{ text.id }}</h5>
                            <small>{{ text.created_at.strftime('%b %d, %Y') }}</small>
                        </div>
                        <p class="mb-1">{{ text.text_content|truncate(100) }}</p>
                        <div class="d-flex gap-2 mt-2">
                            <a href="{{ url_for('view_text', text_id=text.id) }}" class="btn btn-sm btn-outline-primary">View</a>
                            <a href="{{ url_for('generate_audio', text_id=text.id) }}" class="btn btn-sm btn-outline-success">Generate Audio</a>
                            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#removeTextModal" data-text-id="{{ text.id }}">Remove</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No text content added to this project yet.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTextModal">
                    Add Text
                </button>
            </div>
        {% endif %}
    </div>
    
    <!-- Photos Tab -->
    <div class="tab-pane fade" id="photos" role="tabpanel" aria-labelledby="photos-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5">Photos</h3>
            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addPhotoModal">
                <i class="bi bi-plus-lg me-1"></i> Upload Photo
            </button>
        </div>
        
        {% if project.photos %}
            <div class="row row-cols-1 row-cols-md-3 g-4">
                {% for photo in project.photos %}
                    <div class="col">
                        <div class="card h-100">
                            <img src="{{ photo.photo_url }}" class="card-img-top" alt="Photo #{{ photo.id }}">
                            <div class="card-body">
                                <h5 class="card-title">Photo #{{ photo.id }}</h5>
                                <p class="card-text text-muted">{{ photo.photo_description or 'No description' }}</p>
                            </div>
                            <div class="card-footer bg-transparent">
                                <button class="btn btn-sm btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#removePhotoModal" data-photo-id="{{ photo.id }}">
                                    <i class="bi bi-trash me-1"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No photos added to this project yet.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPhotoModal">
                    Upload Photo
                </button>
            </div>
        {% endif %}
    </div>
    
    <!-- Audios Tab -->
    <div class="tab-pane fade" id="audios" role="tabpanel" aria-labelledby="audios-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5">Audio Files</h3>
        </div>
        
        {% if project.audios %}
            <div class="list-group">
                {% for audio in project.audios %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Audio #{{ audio.id }}</h5>
                            <small>{{ audio.created_at.strftime('%b %d, %Y') }}</small>
                        </div>
                        <p class="mb-1">{{ audio.audio_text|truncate(100) }}</p>
                        <p class="mb-1"><small class="text-muted">Voice: {{ audio.voice }}</small></p>
                        <div class="mt-2">
                            <audio controls class="w-100">
                                <source src="{{ audio.audio_url }}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                        <div class="d-flex gap-2 mt-2">
                            <a href="{{ url_for('generate_video', audio_id=audio.id) }}" class="btn btn-sm btn-outline-success">Generate Video</a>
                            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#removeAudioModal" data-audio-id="{{ audio.id }}">Remove</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No audio files in this project yet.</p>
                <p>Add text content and generate audio from the Texts tab.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Videos Tab -->
    <div class="tab-pane fade" id="videos" role="tabpanel" aria-labelledby="videos-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5">Videos</h3>
        </div>
        
        {% if project.videos %}
            <div class="row row-cols-1 row-cols-md-2 g-4">
                {% for video in project.videos %}
                    <div class="col">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Video #{{ video.id }}</h5>
                                <p class="card-text text-muted">{{ video.video_text|truncate(100) }}</p>
                                <div class="ratio ratio-16x9 mt-2">
                                    <video controls>
                                        <source src="{{ video.video_url }}" type="video/mp4">
                                        Your browser does not support the video element.
                                    </video>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent">
                                <button class="btn btn-sm btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#removeVideoModal" data-video-id="{{ video.id }}">
                                    <i class="bi bi-trash me-1"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No videos in this project yet.</p>
                <p>Generate videos from the Audio tab using photos.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Presentations Tab -->
    <div class="tab-pane fade" id="powerpoints" role="tabpanel" aria-labelledby="powerpoints-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5">Presentations</h3>
            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#createPresentationModal">
                <i class="bi bi-plus-lg me-1"></i> Create Presentation
            </button>
        </div>
        
        {% if project.powerpoints %}
            <div class="list-group">
                {% for ppt in project.powerpoints %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">{{ ppt.title }}</h5>
                            <small>{{ ppt.created_at.strftime('%b %d, %Y') }}</small>
                        </div>
                        <div class="d-flex gap-2 mt-2">
                            <a href="{{ ppt.ppt_url }}" class="btn btn-sm btn-outline-primary" target="_blank">Download</a>
                            <a href="{{ url_for('create_scorm', ppt_id=ppt.id) }}" class="btn btn-sm btn-outline-success">Create SCORM</a>
                            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#removePPTModal" data-ppt-id="{{ ppt.id }}">Remove</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No presentations in this project yet.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createPresentationModal">
                    Create Presentation
                </button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Modals -->
<!-- Delete Project Modal -->
<div class="modal fade" id="deleteProjectModal" tabindex="-1" aria-labelledby="deleteProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteProjectModalLabel">Delete Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete "{{ project.name }}"? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('delete_project', project_id=project.id) }}" method="post">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Text Modal -->
<div class="modal fade" id="addTextModal" tabindex="-1" aria-labelledby="addTextModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTextModalLabel">Add Text</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('add_text_to_project', project_id=project.id) }}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="textContent" class="form-label">Text Content</label>
                        <textarea class="form-control" id="textContent" name="text_content" rows="6" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Photo Modal -->
<div class="modal fade" id="addPhotoModal" tabindex="-1" aria-labelledby="addPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addPhotoModalLabel">Upload Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('upload_photo_to_project', project_id=project.id) }}" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="photoFile" class="form-label">Select Photo</label>
                        <input class="form-control" type="file" id="photoFile" name="file" accept="image/*" required>
                    </div>
                    <div class="mb-3">
                        <label for="photoDescription" class="form-label">Description (optional)</label>
                        <input type="text" class="form-control" id="photoDescription" name="description">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Presentation Modal -->
<div class="modal fade" id="createPresentationModal" tabindex="-1" aria-labelledby="createPresentationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createPresentationModalLabel">Create Presentation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('create_presentation', project_id=project.id) }}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="presentationTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="presentationTitle" name="title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Select Videos to Include</label>
                        <div class="list-group">
                            {% for video in project.videos %}
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="videos[]" value="{{ video.id }}">
                                    Video #{{ video.id }} - {{ video.video_text|truncate(50) }}
                                </label>
                            {% endfor %}
                        </div>
                        {% if not project.videos %}
                            <div class="alert alert-warning mt-2">
                                No videos available. Create videos first to include in the presentation.
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" {% if not project.videos %}disabled{% endif %}>Create</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}

{% block scripts %}
<script>
    // Initialize all modals with data attributes
    document.addEventListener('DOMContentLoaded', function() {
        const removeTextModal = document.getElementById('removeTextModal');
        if (removeTextModal) {
            removeTextModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const textId = button.getAttribute('data-text-id');
                const form = removeTextModal.querySelector('form');
                form.action = "{{ url_for('remove_text_from_project', project_id=project.id) }}".replace('__TEXT_ID__', textId);
            });
        }
        
        // Similar event listeners for other remove modals
        // ...
    });
</script>
{% endblock %}
